<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Budget Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f7f7f7;
        }

        h1 {
            color: #333;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        label {
            display: block;
            margin-top: 10px;
        }

        input, select, button {
            margin-top: 5px;
            padding: 8px;
            width: 100%;
            max-width: 300px;
        }

        pre, table {
            background-color: #eee;
            padding: 10px;
            border-radius: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #ddd;
        }

        #login-section, #app-section {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Budget Manager</h1>

    <div class="section" id="login-section">
        <h2>Connexion</h2>
        <label>Nom d'utilisateur :</label>
        <input type="text" id="login-username">
        <label>Mot de passe :</label>
        <input type="password" id="login-password">
        <button onclick="login()">Se connecter</button>
        <pre id="login-message"></pre>
    </div>

    <div class="section" id="app-section">
        <h2>Bienvenue</h2>
        <p>Jeton JWT stocké !</p>
        <button onclick="logout()">Se déconnecter</button>
        <pre id="jwt-token"></pre>
    </div>

    <script>
        const LOGIN_API = "https://localhost:7058/api/login";

        function show(sectionId) {
            document.getElementById("login-section").style.display = "none";
            document.getElementById("app-section").style.display = "none";
            document.getElementById(sectionId).style.display = "block";
        }

        function login() {
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;

            fetch(LOGIN_API, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userName: username, password })
            })
            .then(async res => {
                if (!res.ok) throw new Error(await res.text());
                return res.text();
            })
            .then(token => {
                localStorage.setItem("jwt", token);
                document.getElementById("jwt-token").textContent = token;
                show("app-section");
            })
            .catch(err => {
                document.getElementById("login-message").textContent = "Erreur: " + err.message;
            });
        }

        function logout() {
            localStorage.removeItem("jwt");
            document.getElementById("login-username").value = "";
            document.getElementById("login-password").value = "";
            document.getElementById("jwt-token").textContent = "";
            document.getElementById("login-message").textContent = "";
            show("login-section");
        }

        // auto-login if token exists
        if (localStorage.getItem("jwt")) {
            document.getElementById("jwt-token").textContent = localStorage.getItem("jwt");
            show("app-section");
        } else {
            show("login-section");
        }
    </script>
</body>
</html>